# Verifier Portal - Credential Verification Service

The Verifier Portal is a Dart-based server implementing the Verifiable Data Sharing Protocol (VDSP) for credential verification. It provides multiple real-world verification scenarios with QR code generation for mobile wallet interaction.

## ğŸ“– Table of Contents
- [Overview](#-overview)
- [Architecture](#%EF%B8%8F-architecture)
- [Structure](#-structure)
- [Setup Process](#-setup-process)
- [Configuration](#-configuration)
- [Usage](#-usage)
- [Verification Protocol Flow](#-verification-protocol-flow)
- [Scenario Configurations](#-scenario-configurations)
- [Key Features](#-key-features)
- [Development](#-development)
- [Related Documentation](#-related-documentation)

## ğŸ“‹ Overview

This service acts as the verification endpoint in the Ayra ecosystem, enabling:

- **Multi-Scenario Verification**: Four real-world verification use cases
- **QR Code Generation**: Dynamic QR codes for mobile app scanning
- **VDSP Protocol**: Standards-compliant credential presentation
- **Trust Registry Integration**: Validates issuer trustworthiness
- **Selective Disclosure**: Request only necessary credential attributes

### Landing Page

![Verifier Portal Landing](../images/verifier/landing-page.png)

### Home Dashboard

![Verifier Portal Home](../images/verifier/home.png)

## ğŸ—ï¸ Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Mobile App     â”‚
â”‚   (Holder)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Scan QR
         â”‚ Present Credential (VDSP)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Verifier Portal  â”‚â”€â”€â”€â”€â”€â–¶â”‚  Trust Registry  â”‚
â”‚  (Dart Server)   â”‚      â”‚  (Validation)    â”‚
â”‚   Port: 8081     â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ Structure

```
verifier-portal/
â”œâ”€â”€ setup.sh              # Setup and configuration script
â”œâ”€â”€ docker-compose.yml    # Docker container configuration
â””â”€â”€ code/                 # Verifier portal code (included in repository)
    â”œâ”€â”€ bin/              # Dart executable
    â”œâ”€â”€ lib/              # Source code
    â”‚   â”œâ”€â”€ scenarios/    # Verification scenarios
    â”‚   â”œâ”€â”€ models/       # Data models
    â”‚   â””â”€â”€ services/     # Business logic
    â”œâ”€â”€ .env              # Environment configuration (generated by setup)
    â””â”€â”€ pubspec.yaml      # Dart dependencies
```

## ğŸš€ Setup Process

### Automatic Setup (Recommended)

Run from project root:

```bash
./setup-ayra.sh
```

This automatically:

1. Verifies the verifier portal code is present
2. Configures environment variables
3. Updates domains and endpoints
4. Prepares for Docker deployment

### Manual Setup

```bash
cd verifier-portal
./setup.sh
```

### What the Setup Does

1. **Verify Code**: Confirms verifier portal code is present in `code/` directory
2. **Environment Configuration**: Creates `.env` with:
   - Trust Registry endpoint
   - Service DID and Mediator DID
   - Storage backend settings
3. **Domain Configuration**: Updates verifier domains from ngrok

## ğŸ”§ Configuration

### Environment Variables

Located in `code/.env` (auto-generated):

```bash
# Trust Registry
TR_API_ENDPOINT=https://ghi789.ngrok-free.app

# Affinidi Services
SERVICE_DID=did:web:example.com:service
MEDIATOR_DID=did:web:example.com:mediator

# Storage Configuration
VER_STORAGE_BACKEND=file
VER_REDIS_HOST=localhost
VER_REDIS_PORT=6379
VER_REDIS_SECURE=false

# Verifier Domain (auto-configured)
VERIFIER_DOMAIN=def456.ngrok-free.app
```

### Docker Configuration

Located in `docker-compose.yml`:

```yaml
services:
  verifier-portal:
    build:
      context: ./code
      dockerfile: Dockerfile
    container_name: verifier-portal
    ports:
      - "8081:8081"
    env_file:
      - ./code/.env
    networks:
      - ayra-network
    restart: unless-stopped
```

## ğŸ® Usage

### Starting the Service

```bash
# From project root
docker compose up -d verifier-portal

# Check logs
docker compose logs -f verifier-portal
```

### Accessing the Portal

- **URL**: `https://<verifier-domain>.ngrok-free.app`
- **Port**: 8081 (mapped to host)

### Verification Scenarios

The portal implements four real-world verification scenarios. All scenarios accept **Ayra Business Card** credentials issued through the issuer portal. Each scenario has specific requirements and validation rules.

## ğŸ” Verification Protocol Flow

All verification scenarios follow the standard VDSP (Verifiable Data Sharing Protocol) flow:

### Step-by-Step Flow

1. **QR Code Display**: Verifier portal generates and displays QR code containing OOB (Out-of-Band) URL
2. **Connection Establishment**: Mobile app scans QR code and uses OOB URL to establish secure connection with verifier via DIDComm
3. **Trigger Request**: Holder (mobile app) sends a trigger request to the verifier
4. **VDSP Request**: Verifier responds with a VDSP presentation request containing DCQL (Data Credential Query Language) for requesting Ayra Business Card credential
5. **Credential Selection**: Holder receives the request and selects matching Ayra Business Card credential
6. **VP Creation**: Holder creates Verifiable Presentation (VP) with the requested credential
7. **Data Response**: Holder sends VDSP data response containing the VP to verifier
8. **Integrity Check**: Verifier validates the VP for cryptographic integrity and signature verification
9. **Trust Registry Validation**: Verifier performs comprehensive checks:
   - Is issuer(Sweetlane-bank) recognized by ecosystem (Sweetlane-group) ?
   - Is issuer authorized to issue ayra business card under ecosystem ?
   - Is ecosystem recognised by ayra ?
10. **Rule Engine Validation**: Additional scenario-specific checks (see individual scenarios below)
11. **Access Decision**: Grant or deny access based on validation results

## ğŸ¯ Scenario Configurations

Below are the four verification scenarios with their specific configurations:

#### 1. ğŸ¢ Building Access (Kiosk)

**Scenario ID**: `kiosk`
**Use Case**: Secure access control for office building entry

**Configuration**:

```json
{
  "id": "kiosk",
  "name": "Building Access",
  "description": "Secure access control for office building",
  "type": "internal",
  "purpose": "Share your credentials to get secure access to the building",
  "permanent_did": "did:key:zDnaepSYCXiKhKJxekjMDApARBnqFPvghsLgDMJDBLFyHtvrc",
  "oob_url": "https://b1140049-55a0-4a0b-8515-dd2bb82a237a.mpx.affinidi.io/v1/get-oob/d713f7b6-3535-4d69-a163-32802efdaca3"
}
```

**Screenshots**:

![Building Access QR](../images/verifier/building-access.png)
_QR code display for building access verification_

![Building Access Success](../images/verifier/building-access-success.png)
_Successful verification result_

#### 2. ğŸ¯ Strategy Session (Round Table)

**Scenario ID**: `roundtable`
**Use Case**: Secure access control for 6th floor strategy session area

**Configuration**:

```json
{
  "id": "roundtable",
  "name": "Strategy Session",
  "description": "Secure access control for 6th floor session",
  "type": "internal",
  "purpose": "Share your credentials to have session in secure area",
  "permanent_did": "did:key:zDnaejk34idcWVvzuAmm68PwZByZsmwtJtxH8Ka8yeUqXMA8b",
  "oob_url": "https://b1140049-55a0-4a0b-8515-dd2bb82a237a.mpx.affinidi.io/v1/get-oob/a6ce91e6-a373-4c88-b9de-c0e1a38cae10"
}
```

**Screenshots**:

![Lobby Access QR](../images/verifier/lobby-access.png)
_QR code display for secure area access_

#### 3. ğŸ¨ Hotel Check-in

**Scenario ID**: `check-in-desk`
**Use Case**: Fast and secure hotel check-in with identity verification

**Configuration**:

```json
{
  "id": "check-in-desk",
  "name": "Hotel Check-in",
  "description": "Fast and secure hotel check-in",
  "type": "external",
  "purpose": "Share your credentials to have a smooth check-in experience",
  "permanent_did": "did:key:zDnaehEXxK2zEBKGimA8TtUDjYoYpYhQU8gwAAWsfdKvPVdUf",
  "oob_url": "https://b1140049-55a0-4a0b-8515-dd2bb82a237a.mpx.affinidi.io/v1/get-oob/77d5617c-99b4-471a-af71-26b8d3665a80"
}
```

**Screenshots**:

![Hotel Access QR](../images/verifier/hotel-access.png)
_QR code display for hotel check-in_

![Hotel Check-in Success](../images/verifier/hotel-checking-success.png)
_Successful check-in verification_

#### 4. â˜• Coffee Shop Discount

**Scenario ID**: `coffeeshop`
**Use Case**: Exclusive offers and rewards for Ayra Business Card holders

**Configuration**:

```json
{
  "id": "coffeeshop",
  "name": "Coffee Shop",
  "description": "Exclusive offers and rewards",
  "type": "external",
  "purpose": "Share your credentials to get exclusive offers/rewards",
  "permanent_did": "did:key:zDnaemjDtrFMhF28BvDaWLJJVs5SihgJxeAs5aQizmRw9e4tY",
  "oob_url": "https://b1140049-55a0-4a0b-8515-dd2bb82a237a.mpx.affinidi.io/v1/get-oob/24310fdc-294a-483b-b256-99c4928f4b17"
}
```

**Screenshots**:

![Coffee Shop QR](../images/verifier/coffee-shop.png)
_QR code display for coffee shop discount_

![Coffee Shop Success](../images/verifier/coffee-shop-success.png)
_Successful discount verification_

---

## ğŸ”‘ Key Features

### 1. VDSP Protocol Implementation

The verifier portal implements the Verifiable Data Sharing Protocol (VDSP) with DIDComm messaging and DCQL (Data Credential Query Language) for requesting credentials.

#### Connection Flow via OOB URL

1. **QR Code Generation**: Portal generates QR code containing OOB (Out-of-Band) invitation URL using Meeting place SDK
2. **Scanning**: Mobile app scans QR code and extracts OOB URL
3. **Connection Establishment**: App uses OOB URL to establish secure DIDComm connection with verifier
4. **Handshake**: DIDComm connection handshake completed, both parties exchange DIDs

**Verification Results**:

![Verified Details](../images/verifier/verified-details.png)
_Detailed view of verified credential attributes_

![Verified Payload](../images/verifier/verified-payload.png)
_Complete verification payload and response_

## ğŸ› ï¸ Development

### Building Locally

```bash
cd code

# Install dependencies
dart pub get

# Run development server
dart run bin/server.dart
```

## ğŸ“š Related Documentation

- [Main Setup Guide](../README.md)
- [Issuer Portal](../issuer-portal/README.md)
- [Trust Registry API](../trust-registry-api/README.md)
- [Mobile App](../mobile-app/README.md)
- [VDSP Protocol](https://github.com/affinidi/affinidi-vdxp-docs)
- [W3C Verifiable Presentations](https://www.w3.org/TR/vc-data-model/#presentations)

**Note:** Keep ngrok tunnels running for QR codes and verification endpoints to be accessible!
